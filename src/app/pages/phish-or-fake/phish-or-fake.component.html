<div class="flex flex-column gap-3">
  <div class="flex flex-row justify-content-between align-items-end">
    <div class="flex flex-column">
      <h1 class="page-h1">Phish or Fake Emails</h1>
      <div
        class="flex flex-row text-yellow-500 text-sm justify-content-start gap-2"
      >
        <i class="pi pi-exclamation-triangle"></i>
        <span>Minimum emails for Phish or Fake are 10</span>
      </div>
    </div>
    <button pButton icon="pi pi-plus" (click)="toggleCreateEmailDialogVisibility()">Create Email</button>
  </div>
  <div class="surface-100 border-round flex flex-column gap-2 p-4" *ngIf="!isLoading, else loading">
    @if (emails.length <= 0) { No emails yet. } @else {
    <p-table [value]="emails" [paginator]="true" [rows]="10">
      <ng-template #header>
        <tr>
          <th>No.</th>
          <th>Subject</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template #body let-email let-rowIndex="rowIndex">
        <tr>
          <td>{{ rowIndex + 1 }}</td>
          <td>{{ email.subject }}</td>
          <td>
            <p-badge
              [value]="email.is_phishing ? 'Phishing' : 'Normal'"
              [severity]="email.is_phishing ? 'danger' : 'success'"
              badgeSize="small"
            ></p-badge>
          </td>
          <td>
            <span class="flex flex-row gap-2">
              <p-button icon="pi pi-eye" [rounded]="true" [outlined]="true" size="small"></p-button>
              <p-button icon="pi pi-file-edit" [rounded]="true" [outlined]="true" size="small"></p-button>
              <p-button icon="pi pi-trash" [rounded]="true" [outlined]="true" size="small" *ngIf="emails.length > 10"></p-button>
            </span>
          </td>
        </tr>
      </ng-template>
    </p-table>
    }
  </div>
  <ng-template #loading>
    <p-skeleton width="100%" height="4rem" />
  </ng-template>
</div>

<p-dialog header="Create New Email" [modal]="true" [(visible)]="visible" [style]="{ width: '50%' }" (onHide)="resetCreateEmailForm()">
  <form [formGroup]="createEmailForm" (ngSubmit)="onCreateEmail()">
    <div class="flex flex-column align-items-start gap-1 mb-4">
      <label for="subject" class="font-semibold">Subject</label>
      <input pInputText id="subject" formControlName="subject" class="w-full" />
      @if (isFieldInvalid('subject')) {
        <span class="text-red-500 text-xs" *ngIf="createEmailForm.get('subject')?.errors?.['required']">Subject is required</span>
      } 
    </div>
    <div class="flex flex-column align-items-start gap-1 mb-4">
      <label for="senderEmail" class="font-semibold">Sender Email</label>
      <input pInputText id="senderEmail" formControlName="senderEmail" class="w-full" />
      @if (isFieldInvalid('senderEmail')) {
        <span class="text-red-500 text-xs" *ngIf="createEmailForm.get('senderEmail')?.errors?.['required']">Sender email is required</span>
      } 
    </div>
    <div class="flex flex-column align-items-start gap-1 mb-4">
      <label for="content" class="font-semibold">Content</label>
      <textarea pTextarea id="content" formControlName="content" rows="6" cols="77"></textarea>
      @if (isFieldInvalid('content')) {
        <span class="text-red-500 text-xs" *ngIf="createEmailForm.get('content')?.errors?.['required']">Content is required</span>
      } 
    </div>
    <div class="flex flex-row justify-content-between gap-2 mb-4">
      <label for="is_phishing" class="font-semibold">This is a phishing email</label>
      <p-toggleswitch id="is_phishing" formControlName="isPhishing"></p-toggleswitch>
    </div>
    <div class="flex justify-content-end gap-2">
        <p-button label="Cancel" severity="secondary" (click)="toggleCreateEmailDialogVisibility()" />
        <p-button label="Create" type="submit" />
    </div>
  </form>
</p-dialog>

<p-toast></p-toast>
